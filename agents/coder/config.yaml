# ============================================================================
# agents/coder/config.yaml
# Configuration compl√®te de l'Agent Coder - Version 2.2.0
# ============================================================================

agent:
  # === IDENTIFICATION ET M√âTADONN√âES ===
  name: "CoderAgent"
  class_name: "CoderAgent"
  module_path: "agents.coder.coder"
  display_name: "D√©veloppeur Principal"
  version: "2.2.0"
  description: "Agent principal responsable du d√©veloppement complet du code backend, frontend, DevOps, tests et documentation. Impl√©mente une approche TDD et garantit la qualit√© du code."
  purpose: "D√©veloppement et impl√©mentation de code complet avec validation continue et respect des standards."
  
  # === TYPE ET CARACT√âRISTIQUES ===
  agent_type: "concrete"
  abstract: false
  instantiate: true
  enabled: true
  mandatory: true
  singleton: false

  # === H√âRITAGE ET D√âPENDANCES ===
  extends: "BaseAgent"
  parent: "BaseAgent"
  dependencies:
    - "architect"
  initialization_order: 2

  # === R√àGLES SP√âCIFIQUES ANTI-HALLUCINATION ===
  anti_hallucination:
    enabled: true
    confidence_threshold: 0.8  # Plus √©lev√© que le base_agent car le code doit √™tre fiable
    
    # V√©rifications obligatoires
    mandatory_checks:
      - "verify_code_compilation"
      - "check_syntax_validity"
      - "validate_imports_exist"
      - "detect_dead_code"
      - "ensure_no_hardcoded_secrets"
    
    # Patterns de code interdits (hallucinations fr√©quentes)
    forbidden_code_patterns:
      - pattern: "tx\\.origin"
        reason: "Vuln√©rabilit√© de s√©curit√©"
        severity: "critical"
      - pattern: "block\\.timestamp.*=="
        reason: "Manipulation possible par les mineurs"
        severity: "high"
      - pattern: "address\\.call\\.value.*\\(.*\\)"
        reason: "Risque de r√©entrance sans mutex"
        severity: "high"
      - pattern: "require\\(.*,.*\\);"  # Sans message d'erreur
        reason: "Message d'erreur obligatoire pour le d√©bogage"
        severity: "medium"
      - pattern: "function.*external.*{.*}"
        reason: "Fonction externe sans documentation NatSpec"
        severity: "medium"
      - pattern: "pragma.*\\^"
        reason: "Version flottante, utiliser une version fixe"
        severity: "low"
    
    # V√©rifications de coh√©rence
    consistency_checks:
      - "function_names_match_documentation"
      - "parameters_match_events"
      - "return_values_match_specs"
      - "gas_estimates_are_plausible"
    
    # Gestion de l'incertitude
    uncertainty_handling:
      threshold: 0.7
      markers:
        - code: "// ‚ö†Ô∏è OPTIMISATION POSSIBLE"
        - code: "// üîç √Ä REVOIR: Logique complexe"
        - code: "// ‚ùì CHOIX D'ARCHITECTURE √Ä CONFIRMER"
        - code: "// TODO: V√©rifier cette condition limite"
      fallback_action: "generate_with_comments"
      require_human_review_if_below: 0.5

  # === CAPACIT√âS SP√âCIFIQUES ===
  capabilities:
    - name: "VALIDATE_CONFIG"
      description: "Valide la configuration du projet"
      confidence_required: 0.9
    - name: "ANALYZE_ARCHITECTURE_DETAILED"
      description: "Analyse d√©taill√©e de l'architecture"
      confidence_required: 0.8
    - name: "GENERATE_BACKEND_MICROSERVICES"
      description: "G√©n√®re des microservices backend complets"
      confidence_required: 0.8
    - name: "GENERATE_FRONTEND_APPLICATION"
      description: "G√©n√®re des applications frontend"
      confidence_required: 0.8
    - name: "GENERATE_DEVOPS_INFRASTRUCTURE"
      description: "G√©n√®re l'infrastructure DevOps (Docker, K8s)"
      confidence_required: 0.8
    - name: "IMPLEMENT_REST_APIS"
      description: "Impl√©mente des APIs REST"
      confidence_required: 0.85
    - name: "IMPLEMENT_GRAPHQL_APIS"
      description: "Impl√©mente des APIs GraphQL"
      confidence_required: 0.85
    - name: "IMPLEMENT_WEBSOCKET_SERVICES"
      description: "Impl√©mente des services WebSocket"
      confidence_required: 0.8
    - name: "INTEGRATE_RELATIONAL_DATABASES"
      description: "Int√®gre des bases de donn√©es relationnelles"
      confidence_required: 0.85
    - name: "INTEGRATE_NOSQL_DATABASES"
      description: "Int√®gre des bases de donn√©es NoSQL"
      confidence_required: 0.8
    - name: "INTEGRATE_CACHING_LAYERS"
      description: "Int√®gre des couches de cache (Redis)"
      confidence_required: 0.8
    - name: "INTEGRATE_MESSAGE_QUEUES"
      description: "Int√®gre des queues de messages (RabbitMQ, Kafka)"
      confidence_required: 0.8
    - name: "SETUP_WEB3_INTEGRATION_COMPLETE"
      description: "Configure l'int√©gration Web3 compl√®te"
      confidence_required: 0.9
    - name: "IMPLEMENT_STATE_MANAGEMENT_ADVANCED"
      description: "Impl√©mente la gestion d'√©tat avanc√©e"
      confidence_required: 0.8
    - name: "CREATE_UI_COMPONENT_LIBRARY"
      description: "Cr√©e une librairie de composants UI"
      confidence_required: 0.7
    - name: "IMPLEMENT_AUTHENTICATION_AUTHORIZATION"
      description: "Impl√©mente l'authentification et l'autorisation"
      confidence_required: 0.95  # Critique
    - name: "OPTIMIZE_PERFORMANCE_COMPREHENSIVE"
      description: "Optimise les performances de fa√ßon compl√®te"
      confidence_required: 0.8
    - name: "WRITE_UNIT_TESTS_COMPREHENSIVE"
      description: "√âcrit des tests unitaires complets"
      confidence_required: 0.9
    - name: "WRITE_INTEGRATION_TESTS"
      description: "√âcrit des tests d'int√©gration"
      confidence_required: 0.9
    - name: "WRITE_E2E_TESTS"
      description: "√âcrit des tests end-to-end"
      confidence_required: 0.9
    - name: "DOCUMENT_CODE_COMPREHENSIVE"
      description: "Documente le code de fa√ßon compl√®te"
      confidence_required: 0.7
    - name: "ENFORCE_CODING_STANDARDS_STRICT"
      description: "Applique strictement les standards de codage"
      confidence_required: 0.95
    - name: "REFACTOR_CODE_CONTINUOUSLY"
      description: "Refactorise le code en continu"
      confidence_required: 0.8
    - name: "IMPLEMENT_ERROR_HANDLING"
      description: "Impl√©mente la gestion d'erreurs"
      confidence_required: 0.9
    - name: "IMPLEMENT_LOGGING_TRACING"
      description: "Impl√©mente le logging et le tracing"
      confidence_required: 0.85
    - name: "SETUP_CI_CD_PIPELINES"
      description: "Configure les pipelines CI/CD"
      confidence_required: 0.8
    - name: "CONTAINERIZE_APPLICATIONS"
      description: "Conteneurise les applications"
      confidence_required: 0.8
    - name: "ORCHESTRATE_WITH_KUBERNETES"
      description: "Orchestre avec Kubernetes"
      confidence_required: 0.8
    - name: "IMPLEMENT_MONITORING_METRICS"
      description: "Impl√©mente le monitoring et les m√©triques"
      confidence_required: 0.8
    - name: "OPTIMIZE_SECURITY_POSTURE"
      description: "Optimise la posture de s√©curit√©"
      confidence_required: 0.9

  # === CONFIGURATION LLM AVANC√âE ===
  llm_config:
    enabled: true
    model: "ollama:deepseek-coder:6.7b"
    temperature: 0.15  # Bas pour plus de d√©terminisme
    max_tokens: 16000
    top_p: 0.9
    frequency_penalty: 0.1
    presence_penalty: 0.1
    
    # Param√®tres anti-hallucination
    anti_hallucination_params:
      repetition_penalty: 1.2
      length_penalty: 1.0
      no_repeat_ngram_size: 3
      do_sample: false  # Mode d√©terministe pour le code
      num_beams: 3  # Beam search pour meilleure qualit√©
      
    # Validation des r√©ponses
    response_validation:
      require_syntax_check: true
      require_compilation_check: true
      max_attempts: 3
      fallback_model: "ollama:codellama:13b"  # Mod√®le plus gros si √©chec

  # === OUTILS DISPONIBLES ===
  tools:
    - name: "code_generator_multi_language"
      description: "G√©n√®re du code dans plusieurs langages"
      validation_required: true
    - name: "api_designer_rest_graphql"
      description: "Con√ßoit des APIs REST et GraphQL"
      validation_required: true
    - name: "database_designer_sql_nosql"
      description: "Con√ßoit des bases de donn√©es"
      validation_required: true
    - name: "web3_integrator_complete"
      description: "Int√®gre des composants Web3"
      validation_required: true
    - name: "test_generator_unit_integration_e2e"
      description: "G√©n√®re des tests"
      validation_required: true
    - name: "documentation_generator_comprehensive"
      description: "G√©n√®re de la documentation"
      validation_required: false
    - name: "security_scanner_static_dynamic"
      description: "Scanne la s√©curit√©"
      validation_required: true
    - name: "performance_analyzer_profiling"
      description: "Analyse les performances"
      validation_required: true
    - name: "ci_cd_pipeline_builder"
      description: "Construit des pipelines CI/CD"
      validation_required: true
    - name: "container_orchestration_designer"
      description: "Con√ßoit l'orchestration de conteneurs"
      validation_required: true
    - name: "monitoring_observability_setup"
      description: "Configure le monitoring"
      validation_required: true
    - name: "code_review_automation"
      description: "Automatise les revues de code"
      validation_required: true

  # === OUTPUTS PRODUITS ===
  outputs:
    - name: "backend_microservices_code"
      type: "code"
      format: "multiple_files"
      validation: "compilation+testing"
    - name: "frontend_application_code"
      type: "code"
      format: "multiple_files"
      validation: "build+testing"
    - name: "devops_infrastructure_code"
      type: "code"
      format: "yaml/dockerfile"
      validation: "syntax+deployment"
    - name: "api_specifications_implemented"
      type: "documentation"
      format: "openapi/graphql"
      validation: "spec_validator"
    - name: "database_schemas_migrations"
      type: "code"
      format: "sql/migrations"
      validation: "execution_test"
    - name: "test_suites_comprehensive"
      type: "code"
      format: "test_files"
      validation: "coverage+execution"
    - name: "documentation_technical_user"
      type: "documentation"
      format: "markdown"
      validation: "completeness"
    - name: "ci_cd_pipeline_configs"
      type: "code"
      format: "yaml"
      validation: "syntax+simulation"
    - name: "docker_kubernetes_configs"
      type: "code"
      format: "dockerfile/yaml"
      validation: "build+deploy_test"
    - name: "monitoring_dashboards_alerts"
      type: "configuration"
      format: "json/yaml"
      validation: "syntax+simulation"
    - name: "security_scans_reports"
      type: "report"
      format: "json/html"
      validation: "findings_review"
    - name: "performance_benchmarks"
      type: "report"
      format: "json"
      validation: "trend_analysis"

  # === R√àGLES DE VALIDATION ===
  validation_rules:
    - name: "all_code_must_compile_with_zero_warnings"
      severity: "critical"
      action_on_failure: "reject"
      auto_correct: false
    - name: "test_coverage_must_exceed_90_percent"
      severity: "high"
      action_on_failure: "warn"
      auto_correct: false
    - name: "security_scans_must_pass_critical_high"
      severity: "critical"
      action_on_failure: "reject"
      auto_correct: false
    - name: "performance_benchmarks_must_meet_sla"
      severity: "medium"
      action_on_failure: "warn"
      auto_correct: false
    - name: "api_response_times_p95_under_200ms"
      severity: "medium"
      action_on_failure: "warn"
      auto_correct: false
    - name: "docker_images_must_be_multi_stage_optimized"
      severity: "medium"
      action_on_failure: "auto_correct"
      auto_correct: true
    - name: "kubernetes_manifests_must_follow_best_practices"
      severity: "high"
      action_on_failure: "auto_correct"
      auto_correct: true
    - name: "documentation_must_be_comprehensive_updated"
      severity: "low"
      action_on_failure: "warn"
      auto_correct: false
    - name: "ci_cd_pipelines_must_be_fully_automated"
      severity: "medium"
      action_on_failure: "warn"
      auto_correct: false
    - name: "error_handling_must_be_comprehensive_logged"
      severity: "high"
      action_on_failure: "reject"
      auto_correct: false
    - name: "no_hardcoded_secrets_allowed"
      severity: "critical"
      action_on_failure: "reject"
      auto_correct: false

  # === M√âTRIQUES DE QUALIT√â DE CODE ===
  code_quality_metrics:
    cyclomatic_complexity:
      max_per_function: 10
      action_if_exceeded: "refactor"
    cognitive_complexity:
      max_per_function: 15
      action_if_exceeded: "refactor"
    lines_of_code_per_function:
      max: 50
      action_if_exceeded: "split"
    test_coverage:
      minimum: 90
      target: 95
      action_if_below: "generate_tests"
    security_vulnerabilities:
      critical: 0
      high: 0
      medium: "< 3"
      action_if_found: "fix_automatically"
    performance_bottlenecks:
      max_identified: 0
      action_if_found: "optimize"
    duplication_rate:
      max_percent: 5
      action_if_exceeded: "refactor"
    comment_ratio:
      minimum_percent: 20
      action_if_below: "add_comments"
    documentation_coverage:
      minimum_percent: 80
      action_if_below: "generate_docs"

  # === LANGAGES ET FRAMEWORKS SUPPORT√âS ===
  supported_languages_frameworks:
    backend:
      - name: "Python/FastAPI"
        version: "0.104+"
        confidence: 0.95
      - name: "Node.js/Express"
        version: "18+"
        confidence: 0.9
      - name: "Go/Gin"
        version: "1.21+"
        confidence: 0.85
      - name: "Java/Spring"
        version: "3.x"
        confidence: 0.8
      - name: ".NET Core"
        version: "8.0"
        confidence: 0.8
    frontend:
      - name: "React/Next.js"
        version: "18/14"
        confidence: 0.95
      - name: "Vue/Nuxt.js"
        version: "3/3"
        confidence: 0.9
      - name: "Angular"
        version: "17"
        confidence: 0.8
      - name: "Svelte/SvelteKit"
        version: "4/1"
        confidence: 0.85
    mobile:
      - name: "React Native"
        version: "0.72"
        confidence: 0.85
      - name: "Flutter"
        version: "3.16"
        confidence: 0.8
      - name: "Swift UI"
        version: "iOS 17"
        confidence: 0.7
      - name: "Kotlin Compose"
        version: "Android 14"
        confidence: 0.7
    blockchain:
      - name: "Solidity/Hardhat"
        version: "0.8.19"
        confidence: 0.9
      - name: "Rust/Anchor"
        version: "1.70/0.29"
        confidence: 0.8
      - name: "Move/Aptos"
        version: "1.0"
        confidence: 0.7
      - name: "Cairo/Starknet"
        version: "2.4"
        confidence: 0.7
    devops:
      - name: "Docker"
        version: "24+"
        confidence: 0.95
      - name: "Kubernetes"
        version: "1.28+"
        confidence: 0.9
      - name: "Terraform"
        version: "1.5+"
        confidence: 0.85
      - name: "Ansible"
        version: "9.0"
        confidence: 0.8
      - name: "GitHub Actions"
        version: "v4"
        confidence: 0.9
      - name: "GitLab CI"
        version: "16+"
        confidence: 0.85
    databases:
      - name: "PostgreSQL"
        version: "15+"
        confidence: 0.95
      - name: "MySQL"
        version: "8+"
        confidence: 0.9
      - name: "MongoDB"
        version: "7+"
        confidence: 0.9
      - name: "Redis"
        version: "7+"
        confidence: 0.95
      - name: "Cassandra"
        version: "4+"
        confidence: 0.8
      - name: "Elasticsearch"
        version: "8+"
        confidence: 0.85

  # === WORKFLOW DE COLLABORATION ===
  collaboration_workflow:
    steps:
      - step: "receive_architecture_from_architect_agent"
        input: "architecture_design"
        validation: "completeness_check"
        timeout: 300
      - step: "implement_features_with_tdd_approach"
        process: "test_driven_development"
        validation: "test_coverage"
      - step: "collaborate_with_tester_agent_for_validation"
        agent: "tester"
        validation_type: "cross_validation"
        required: true
      - step: "integrate_with_smart_contract_agent_for_blockchain"
        agent: "smart_contract"
        condition: "blockchain_features_needed"
      - step: "collaborate_with_frontend_web3_agent_for_ui"
        agent: "frontend_web3"
        condition: "frontend_needed"
      - step: "deploy_with_devops_automation"
        agent: "devops"
        validation: "deployment_success"
      - step: "monitor_with_observability_stack"
        agent: "monitoring"
        validation: "metrics_collected"

  # === CONFIGURATION SYST√àME ===
  system:
    timeout_seconds: 3600
    max_retries: 5
    concurrent_tasks: 3
    log_level: "DEBUG"
    enable_auto_format: true
    enable_linting: true
    
    # Politique de retry
    retry_policy:
      max_attempts: 3
      backoff_factor: 2.0
      jitter: 0.1
      retryable_errors:
        - "TimeoutError"
        - "CompilationError"
        - "LLMUnavailableError"

  # === ENVIRONNEMENTS ===
  environments:
    development:
      enabled: true
      validation_level: "basic"
      auto_deploy: false
    staging:
      enabled: true
      validation_level: "comprehensive"
      auto_deploy: true
    production:
      enabled: true
      validation_level: "strict"
      auto_deploy: false
      require_human_approval: true

  # === TESTS ===
  testing:
    unit_tests:
      enabled: true
      required: true
      min_coverage: 90
    integration_tests:
      enabled: true
      required: true
      min_coverage: 80
    e2e_tests:
      enabled: true
      required: false
      critical_paths_only: true
    performance_tests:
      enabled: true
      required: false
      sla_check: true
    security_tests:
      enabled: true
      required: true
      scan_type: "comprehensive"

  # === SOUS-AGENTS ===
  subAgents:
    - id: "backend_coder"
      name: "Backend Development"
      display_name: "Backend Development"
      config_path: "agents/coder/sous_agents/backend_coder/config.yaml"
      dependencies: ["coder"]
      specialization: "backend_development"
      
    - id: "devops_coder"
      name: "DevOps"
      display_name: "DevOps"
      config_path: "agents/coder/sous_agents/devops_coder/config.yaml"
      dependencies: ["coder"]
      specialization: "devops_automation"
      
    - id: "frontend_coder"
      name: "Frontend Development"
      display_name: "Frontend Development"
      config_path: "agents/coder/sous_agents/frontend_coder/config.yaml"
      dependencies: ["coder"]
      specialization: "frontend_development"

  # === M√âTADONN√âES ===
  metadata:
    author: "SmartContractDevPipeline"
    maintainer: "dev@poolsync.io"
    license: "Proprietary"
    tags: ["development", "coding", "backend", "frontend", "devops"]
    capabilities_count: 35
    last_reviewed: "2026-02-25"
    next_review: "2026-03-25"